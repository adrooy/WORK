{% extends "base/base.html" %}

{% block title %}游戏详情{% endblock %}

{% block user %}{{user.last_name}}{{user.first_name}}{% endblock %}

{% block content %}

    <div class="content-wrapper">
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-body"> 
                            <table id="example1" class="table table-bordered table-striped">
                                <th style="width: 20%">基本信息</th>
                                <th style="width: 80%">内容</th>
                                <tbody>

                                <tr>
                                    <td>入库人员</td>
                                    <td><input type="text" readonly="readonly" id="" value="{%if info.save_user %}{{ info.save_user }}{% else %}{{''}}{%endif%}" /></td>
                                </tr>
                                <tr>
                                    <td>最后修改人员</td>
                                    <td><input type="text" readonly="readonly" id="" value="{%if info.update_user %}{{ info.update_user }}{% else %}{{''}}{%endif%}" /></td>
                                </tr>
                                <tr>
                                    {% ifequal perm_name '可编辑用户' %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="" onclick="not_play('{{ info.game_id }}')" value="编辑不可玩信息"></td>
                                    {% endifequal %}
                                    {% ifequal user.is_superuser 1 %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="" onclick="not_play('{{ info.game_id }}')" value="编辑不可玩信息"></td>
                                    {% endifequal %}
                                    </td>
                                    <td>
                                        <select class="form-control">
                                            {% for not_play in models %}
                                                <option >{{ not_play.model }}</option>
                                            {% endfor %}
                                            {% for not_play in fingerprints %}
                                                <option>{{ not_play.fingerprint }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>小编点评</td>
                                    <td><textarea name="ckeditor_editor_desc_html">{% if info.editor_desc_html %}{{ info.editor_desc_html }}{% endif %}</textarea></td>
                                </tr>
                                <tr>
                                    <td>游戏名</td>
                                    <td><input style="width:50%" type="text" readonly="readonly" id="label-game-name" value="{%if info.game_name %}{{ info.game_name }}{% else %}{{''}}{%endif%}" /></td>
                                </tr>
                                {% ifequal pkg.market_channel 'google' %}
                                    <tr>
                                        <td>Google游戏详情地址</td>
                                        <td><a target="blank" href="http://play.google.com/store/apps/details?id={{pkg.pkg_name}}">http://play.google.com/store/apps/details?id={{pkg.pkg_name}}</a></td>
                                    </tr>
                                {% endifequal %}
                                <tr>
                                    <td>游戏显示名</td>
                                    <td><input style="width:50%" type="text" id="label-display-name" value="{%if info.display_name%}{{ info.display_name }}{%else%}{{''}}{%endif%}" /></td>
                                </tr>
                                <tr>
                                    <td>游戏搜索名</td>
                                    <td><textarea id="label-game_alias" rows="5" cols="140" class="required" tabindex="4">{% if info.game_alias %}{{ info.game_alias }}{% else %}{{''}}{% endif %}</textarea></td>
                                </tr>
                                <tr>
                                    <td>论坛链接</td>
                                    <td><a id="pkg-post_url" href="http://106.187.54.178/{{ info.post_url }}">http://106.187.54.178/{{ info.post_url }}</a></td>
                                </tr>
                                <tr>
                                    <td>游戏状态</td>
                                    <td>
                                        <input type="radio" style="width:5%;" name="status" value="1" {% ifequal info.status 1 %}{{ "checked" }}{% endifequal %}>未发布</input>
                                        <input type="radio" style="width:5%;" name="status" value="2"{% ifequal info.status 2 %}{{ "checked" }}{% endifequal %}>内测</input>
                                        <input type="radio" style="width:5%;" name="status" value="3"{% ifequal info.status 3 %}{{ "checked" }}{% endifequal %}>已发布</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>用于检查游戏版本更新的地址</td>
                                    <td><textarea style="width:80%;height:30px;" id="detail_url" rows="12" cols="140" class="required" tabindex="4">{%if info.detail_url%}{{ info.detail_url }}{%else%}{{''}}{%endif%}</textarea></td>
                                </tr>
                                <tr>
                                    <td>游戏无效原因</td>
                                    <td><textarea style="width:80%;height:30px;" id="disable_reason" rows="12" cols="140" class="required" tabindex="4">{%if info.disable_reason%}{{ info.disable_reason }}{%else%}{{''}}{%endif%}</textarea></td>
                                </tr>
                                <tr>
                                    <td>角标</td>
                                    <td>
                                        <input type="radio" style="width:5%;" name="subscript" value="0" {% ifequal info.subscript '0' %}{{ "checked" }}{% endifequal %}>无</input>
                                        <input type="radio" style="width:5%;" name="subscript" value="1"{% ifequal info.subscript '1' %}{{ "checked" }}{% endifequal %}>首发</input>
                                        <input type="radio" style="width:5%;" name="subscript" value="2"{% ifequal info.subscript '2' %}{{ "checked" }}{% endifequal %}>推荐</input>
                                        <input type="radio" style="width:5%;" name="subscript" value="3"{% ifequal info.subscript '3' %}{{ "checked" }}{% endifequal %}>热门</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>角标过期时间</td>
                                    <td>
                                        <input type="text" id="subscript_expire_time"
                                               value="{%if info.subscript_expire_time%}{{ info.subscript_expire_time }}{%endif%}" onclick="SelectDate(this,'yyyy-MM-dd')"></input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>彩标</td>
                                    <td>
                                        <!--<input type="checkbox" name="color_label" style="width:5%;" value="1" {% for color_label in color_labels %}{% ifequal color_label '1' %}{{ "checked" }}{% endifequal %}{% endfor %}>免内购</input>-->
                                        <!--<input type="checkbox" name="color_label" style="width:5%;" value="5" {% for color_label in color_labels %}{% ifequal color_label '5' %}{{ "checked" }}{% endifequal %}{% endfor %}>免google</input>-->
                                        <select name="color_label_sel" class="form-control">
                                            <option value="-1">-</option>
                                            <option value="1" {% for color_label in color_labels %}{% ifequal color_label '1' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %} >免内购</option>
                                            <option value="9" {% for color_label in color_labels %}{% ifequal color_label '9' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>有内购</option>
                                            <option value="10" {% for color_label in color_labels %}{% ifequal color_label '10' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>无内购</option>
                                        </select>
                                        <select name="color_label_sel" class="form-control">
                                            <option value="-1">-</option>
                                            <option value="5" {% for color_label in color_labels %}{% ifequal color_label '5' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %} >免谷歌市场</option>
                                            <option value="11" {% for color_label in color_labels %}{% ifequal color_label '11' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>需谷歌市场</option>
                                            <option value="12" {% for color_label in color_labels %}{% ifequal color_label '12' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>无需谷歌市场</option>
                                        </select>
                                        <select name="color_label_sel" class="form-control">
                                            <option value="-1">-</option>
                                            <option value="13" {% for color_label in color_labels %}{% ifequal color_label '13' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %} >全程联网</option>
                                            <option value="14" {% for color_label in color_labels %}{% ifequal color_label '14' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>单机游戏</option>
                                        </select>
                                        <select name="color_label_sel" class="form-control">
                                            <option value="-1">-</option>
                                            <option value="15" {% for color_label in color_labels %}{% ifequal color_label '15' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %} >破解VPN</option>
                                            <option value="16" {% for color_label in color_labels %}{% ifequal color_label '16' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>需VPN</option>
                                            <option value="17" {% for color_label in color_labels %}{% ifequal color_label '17' %}{{ 'selected="selected"' }}{% endifequal %}{% endfor %}>无需VPN</option>
                                        </select>
                                        <div>
                                            <input type="checkbox" name="color_label" value="2" {% for color_label in color_labels %}{% ifequal color_label '2' %}{{ "checked" }}{% endifequal %}{% endfor %}>破解</input>
                                            <input type="checkbox" name="color_label" value="18" {% for color_label in color_labels %}{% ifequal color_label '18' %}{{ "checked" }}{% endifequal %}{% endfor %}>已汉化</input>
                                            <input type="checkbox" name="color_label" value="3" {% for color_label in color_labels %}{% ifequal color_label '3' %}{{ "checked" }}{% endifequal %}{% endfor %}>插件</input>
                                            <input type="checkbox" name="color_label" value="4" {% for color_label in color_labels %}{% ifequal color_label '4' %}{{ "checked" }}{% endifequal %}{% endfor %}>存档</input>
                                            <input type="checkbox" name="color_label" value="6" {% for color_label in color_labels %}{% ifequal color_label '6' %}{{ "checked" }}{% endifequal %}{% endfor %}>免ROOT游戏</input>
                                        </div>
                                        <div>
                                            <input type="checkbox" name="color_label" value="7" {% for color_label in color_labels %}{% ifequal color_label '7' %}{{ "checked" }}{% endifequal %}{% endfor %}>玩家上传</input>
                                            <input type="checkbox" name="color_label" value="8" {% for color_label in color_labels %}{% ifequal color_label '8' %}{{ "checked" }}{% endifequal %}{% endfor %}>内测</input>
                                            <input type="checkbox" name="color_label" value="101" {% for color_label in color_labels %}{% ifequal color_label '101' %}{{ "checked" }}{% endifequal %}{% endfor %}>动漫</input>
                                            <input type="checkbox" name="color_label" value="102" {% for color_label in color_labels %}{% ifequal color_label '102' %}{{ "checked" }}{% endifequal %}{% endfor %}>跑酷</input>
                                            <input type="checkbox" name="color_label" value="103" {% for color_label in color_labels %}{% ifequal color_label '103' %}{{ "checked" }}{% endifequal %}{% endfor %}>角色</input>
                                        </div>
                                        <div>
                                            <input type="checkbox" name="color_label" value="104" {% for color_label in color_labels %}{% ifequal color_label '104' %}{{ "checked" }}{% endifequal %}{% endfor %}>横版</input>
                                            <input type="checkbox" name="color_label" value="105" {% for color_label in color_labels %}{% ifequal color_label '105' %}{{ "checked" }}{% endifequal %}{% endfor %}>格斗</input>
                                            <input type="checkbox" name="color_label" value="106" {% for color_label in color_labels %}{% ifequal color_label '106' %}{{ "checked" }}{% endifequal %}{% endfor %}>3D</input>
                                            <input type="checkbox" name="color_label" value="107" {% for color_label in color_labels %}{% ifequal color_label '107' %}{{ "checked" }}{% endifequal %}{% endfor %}>武侠</input>
                                            <input type="checkbox" name="color_label" value="108" {% for color_label in color_labels %}{% ifequal color_label '108' %}{{ "checked" }}{% endifequal %}{% endfor %}>奇幻</input>
                                        </div>
                                        <div>
                                            <input type="checkbox" name="color_label" value="109" {% for color_label in color_labels %}{% ifequal color_label '109' %}{{ "checked" }}{% endifequal %}{% endfor %}>单手</input>
                                            <input type="checkbox" name="color_label" value="110" {% for color_label in color_labels %}{% ifequal color_label '110' %}{{ "checked" }}{% endifequal %}{% endfor %}>Q版</input>
                                            <input type="checkbox" name="color_label" value="111" {% for color_label in color_labels %}{% ifequal color_label '111' %}{{ "checked" }}{% endifequal %}{% endfor %}>射击</input>
                                            <input type="checkbox" name="color_label" value="112" {% for color_label in color_labels %}{% ifequal color_label '112' %}{{ "checked" }}{% endifequal %}{% endfor %}>MOBA</input>
                                            <input type="checkbox" name="color_label" value="113" {% for color_label in color_labels %}{% ifequal color_label '113' %}{{ "checked" }}{% endifequal %}{% endfor %}>卡牌</input>
                                        </div>
                                        <div>
                                            <input type="checkbox" name="color_label" value="114" {% for color_label in color_labels %}{% ifequal color_label '114' %}{{ "checked" }}{% endifequal %}{% endfor %}>策略</input>
                                            <input type="checkbox" name="color_label" value="115" {% for color_label in color_labels %}{% ifequal color_label '115' %}{{ "checked" }}{% endifequal %}{% endfor %}>经营</input>
                                            <input type="checkbox" name="color_label" value="116" {% for color_label in color_labels %}{% ifequal color_label '116' %}{{ "checked" }}{% endifequal %}{% endfor %}>动作</input>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>游戏ID</td>
                                    <td><input type="text" readonly="readonly" id="label-game-id" value="{{ info.game_id }}" /></td>
                                </tr>
                                <tr>
                                    <td>实际下载量</td>
                                    <td><input type="text" readonly="readonly" id="gg_download_cnt" value="{% if info.gg_download_cnt %}{{ info.gg_download_cnt }}{% endif %}" /></td>
                                </tr>
                                <tr>
                                    <td>实际周下载量</td>
                                    <td><input type="text" readonly="readonly" id="gg_download_week" value="{% if info.gg_download_week %}{{ info.gg_download_week }}{% endif %}" /></td>
                                </tr>
                                <tr>
                                    <td>下载量</td>
                                    <td><input type="text" id="label-download" value="{{ info.download_counts }}" /></td>
                                </tr>
                                <tr>
                                    <td>语言</td>
                                    <td><input type="text" id="label-language" value="{%if info.game_language%}{{ info.game_language }}{%else%}{{''}}{%endif%}" /></td>
                                </tr>
                                <tr>
                                    <td>类型</td>
                                    <td><textarea id="label-type" readonly="readonly" rows="5" cols="140" class="required" tabindex="4">{% if info.origin_types %}{{ info.origin_types }}{% else %}{{''}}{% endif %}</textarea></td>
                                </tr>
                                <tr>
                                    <td>游戏厂商</td>
                                    <td>
                                        {% if dev_names %}
                                            <select id="dev_name_select" class="form-control">
                                                {% if info.developer %}
                                                    {% with flag=True %}
                                                        {% for dev_name in dev_names %}
                                                            {% ifequal dev_name.developer info.developer %}
                                                                {% with flag=False %}{% endwith %}
                                                            {% endifequal %}
                                                        {% endfor %}
                                                        {% if flag %}
                                                            <option value="{{ info.developer }}" selected="selected">{{ info.developer }}</option>
                                                        {% endif %}
                                                    {% endwith %}
                                                {% else %}
                                                    <option>请选择...</option>
                                                {% endif %}
                                                {% for dev_name in dev_names %}
                                                    <option value="{{ dev_name.developer }}" {% ifequal dev_name.developer info.developer %}selected="selected"{% endifequal %}>{{ dev_name.developer }}</option>
                                                {% endfor %}
                                            </select>
                                        {% else %}
                                            {% if info.developer %}{{ info.developer }}{% else %}请在游戏厂商管理中添加游戏{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>编辑分类</td>
                                    <td>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="休闲时间" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '休闲时间' %}{{ "checked" }}{% endifequal %}{% endfor %}>休闲时间</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="跑酷竞速" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '跑酷竞速' %}{{ "checked" }}{% endifequal %}{% endfor %}>跑酷竞速</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="动作射击" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '动作射击' %}{{ "checked" }}{% endifequal %}{% endfor %}>动作射击</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="扑克棋牌" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '扑克棋牌' %}{{ "checked" }}{% endifequal %}{% endfor %}>扑克棋牌</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="体育格斗" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '体育格斗' %}{{ "checked" }}{% endifequal %}{% endfor %}>体育格斗</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="角色扮演" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '角色扮演' %}{{ "checked" }}{% endifequal %}{% endfor %}>角色扮演</input>
                                        <input type="checkbox" name="label_category" style="width:5%;" value="经营策略" {% for origin_type in info.origin_type_list %}{% ifequal origin_type '经营策略' %}{{ "checked" }}{% endifequal %}{% endfor %}>经营策略</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>评分</td>
                                    <td><input type="text" id="label-star" value="{%if info.star_num%}{{ info.star_num }}{%else%}{{''}}{%endif%}" /></td>
                                </tr>
                                <tr>
                                    <td>ICON</td>
                                    <td><img style="width:75px;height:75px;" src="{{ info.icon_url }}">
                                        <input type="text" style="width:74%;" id="label-icon" value="{{ info.icon_url }}" style=""></td>
                                </tr>
                                <tr>
                                    <td>游戏banner图</td>
                                    <td><img style="width:75px;height:75px;" src="{{ info.banner_pic }}">
                                        <input type="text" style="width:74%;" id="banner_pic" value="{% if info.banner_pic %}{{ info.banner_pic }}{% endif %}" style=""></td>
                                </tr>
                                <tr>
                                    <td>ICON</td>
                                    <td>
                                        <label>过滤安装包</label>
                                        <span class="input-group-btn">
                                            <button class="btn btn-info btn-flat" type="button" id="add_filter_pkg_names">增加</button>
                                        </span>
                                        <div class="form-group">
                                            <select multiple class="form-control" id="filter_pkg_names">
                                                {% for filter_pkg_name in info.filter_pkg_names %}
                                                    <option id="option_{{ filter_pkg_name }}" onclick="del_filter_pkg_names('{{ filter_pkg_name }}')" value="{{ filter_pkg_name }}">{{ filter_pkg_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>是否显示图标--热</td>
                                    <td>
                                        <input type="radio" name="show_hot_icon" value="1" {% ifequal info.show_hot_icon 1 %}{{ "checked" }}{% endifequal %}>显示</input>
                                        <input type="radio" name="show_hot_icon" value="０"{% ifequal info.show_hot_icon 0 %}{{ "checked" }}{% endifequal %}>不显示</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>简单描述</td>
                                    <td><textarea style="width:80%;height:30px;" id="label-short-desc" rows="12" cols="140" class="required" tabindex="4">{%if info.short_desc%}{{ info.short_desc }}{%else%}{{''}}{%endif%}</textarea></td>
                                </tr>
                                <tr>
                                    <td>详细描述(html)</td>
                                    <td><textarea name="ckeditor_detail_desc_html">{% if info.detail_desc_html %}{{ info.detail_desc_html }}{% endif %}</textarea>
                                        <input type="radio" style="width:5%;" name="save_detail_desc_html" value="1">保存富文本</input>
                                        <input type="radio" style="width:5%;" name="save_detail_desc_html" value="0" checked="checked">不保存富文本</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>详细描述(text)</td>
                                    <td><textarea style="width:80%;height:500px;" id="label-desc" rows="12" cols="140" class="required" tabindex="4">{{ info.detail_desc }}</textarea></td>
                                </tr>
                                <tr>
                                    <td>
                                        <button class="btn btn-info btn-flat" type="button" id="addScreen">新增截图</button>
                                    </td>
                                    <td>
                                        {% for screen_shot_url in screen_shot_urls %}
                                            <span style="position: relative;">
                                                <img class="screen_shot_url" id="{{ screen_shot_url.num }}IMG" alt="{{ screen_shot_url.num }}" style="width:195px;height:276px;margin-left:10px;margin-top:10px" src="{{ screen_shot_url.url }}" onclick="previewPhoto('{{ screen_shot_url.num }}');" onmouseover="showDeleteDiv('{{ screen_shot_url.num }}');" onmouseout="imgOnmouseout(),hideDeleteDiv('{{ screen_shot_url.num }}');"></input>
                                            </span>
                                        {% endfor %}
                                    </td>
                                </tr>
                                <tr>
                                    {% ifequal perm_name '可编辑用户' %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="label-btn" onclick="label_info_change()" value="确定修改lable信息"></td>
                                    {% endifequal %}
                                    {% ifequal user.is_superuser 1 %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="label-btn" onclick="label_info_change()" value="确定修改lable信息"></td>
                                    {% endifequal %}
                                </tr>
                                </tbody>
                            </table>
                        </div><!-- /.box-body -->
                    </div><!-- /.box -->
                </div><!-- /.col -->
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-body">
                            <table class="table table-bordered">
                                <th>未匹配到插件的渠道</th>
                                <tr id="channels">
                                    {% for channel in channels %}
                                        {% ifequal channel.apk_id pkg.apk_id %}
                                            <td width="10%"><a id="{{channel.apk_id}}" class="pkg_id" style="color:#ff0033" href="javascript:void(0);" onclick="show_info('{{ channel.apk_id }}');">{{ channel.channel }}_{{channel.apk_id}}</td>
                                        {% else %}
                                            <td width="10%"><a id="{{channel.apk_id}}" class="pkg_id" href="javascript:void(0);" onclick="show_info('{{ channel.apk_id }}');">{{ channel.channel }}</td>
                                        {% endifequal %}
                                    {% endfor %}
                                </tr>
                            </table>
                        </div><!-- /.box-body -->
                    </div><!-- /.box -->
                </div><!-- /.col -->
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-body" id=apk>
                            <table class="table table-bordered">
                                <th>匹配到插件的渠道</th>
                                <tr id="plugin_channels">
                                    {% for channel in plugin_channels %}
                                        {% ifequal channel.apk_id pkg.apk_id %}
                                            <td width="10%"><a id="{{channel.apk_id}}" class="pkg_id" style="color:#ff0033" href="javascript:void(0);" onclick="show_info('{{ channel.apk_id }}');">{{ channel.channel }}</td>
                                        {% else %}
                                            <td width="10%"><a id="{{channel.apk_id}}" class="pkg_id" href="javascript:void(0);" onclick="show_info('{{ channel.apk_id }}');">{{ channel.channel }}</td>
                                        {% endifequal %}
                                    {% endfor %}
                                </tr>
                            </table>
                        </div><!-- /.box-body -->
                    </div><!-- /.box -->
                </div><!-- /.col -->
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-body">
                            <table class="table table-bordered">
                                <th style="width: 20%">安装包信息</th>
                                <th style="width: 80%">内容</th>
                                <tbody>
                                <tr>
                                    <td>apk_id</td>
                                    <td><input style="width:50%" type="text" id="pkg-apk_id" value="{{pkg.apk_id}}" readonly="true" /></td>
                                </tr>
                                <tr id="pkg-required_plugin_ids">
                                    {% if pkg.required_plugin_ids %}
                                        <td>插件ID</td>
                                        <td>
                                            {% for id in pkg.required_plugin_ids %}
                                                <a href="/gg_mgmt/game/plugin_detail/?plugin_id={{id}}">{{ id }}</a>&nbsp;
                                            {% endfor %}
                                        </td>
                                    {% endif %}
                                </tr>
                                <tr>
                                    <td>pkg状态</td>
                                    <td>
                                        <input type="radio" style="width:5%;" name="pkg-enabled" value="0" {% ifequal pkg.enabled 0 %}{{ "checked" }}{% endifequal %}>未发布</input>
                                        <input type="radio" style="width:5%;" name="pkg-enabled" value="1"{% ifequal pkg.enabled 1 %}{{ "checked" }}{% endifequal %}>已发布</input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>下载按钮文字</td>
                                    <td><input style="width:50%" type="text" id="pkg-dl_button_txt" value="{%if pkg.dl_button_txt%}{{pkg.dl_button_txt}}{%endif%}"/></td>
                                </tr>
                                <tr>
                                    <td>下载按钮颜色(颜色编码去掉"#")</td>
                                    <td><input style="width:50%" type="text" id="pkg-dl_button_color" value="{%if pkg.dl_button_color%}{{pkg.dl_button_color}}{%endif%}"/></td>
                                </tr>
                                <tr>
                                    <td>gles版本号</td>
                                    <td><input style="width:50%" type="text" id="pkg-gles_version" value="{%if pkg.gles_version%}{{pkg.gles_version}}{%endif%}"/></td>
                                </tr>
                                <tr>
                                    <td>游戏无效原因</td>
                                    <td><textarea style="width:80%;height:30px;" id="pkg-disable_reason" rows="12" cols="140" class="required" tabindex="4">{%if pkg.disable_reason%}{{ pkg.disable_reason }}{%else%}{{''}}{%endif%}</textarea></td>
                                </tr>
                                <tr>
                                    {% ifequal perm_name '可编辑用户' %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="label-btn" onclick="pkg_info_change()" value="确定修改pkg信息"></td>
                                    {% endifequal %}
                                    {% ifequal user.is_superuser 1 %}
                                        <td><input style="width:140px;background:#0099ff;color:#ffffff" type="button" id="label-btn" onclick="pkg_info_change()" value="确定修改pkg信息"></td>
                                    {% endifequal %}
                                </tr>
                                <tr>
                                    <td>论坛链接</td>
                                    <td><a id="pkg-post_url" href="http://106.187.54.178/{{ pkg.post_url }}">http://106.187.54.178/{{ pkg.post_url }}</a></td>
                                </tr>
                                <tr>
                                    <td>下载地址</td>
                                    <td><a id="pkg-down-url" href="{{ pkg.download_url }}">{{ pkg.download_url }}</a></td>
                                </tr>
                                <tr>
                                    <td>详情页地址</td>
                                    <td>{%if pkg.url4details%}<a id="pkg-url4details" href="{{ pkg.url4details }}">{{ pkg.url4details }}</a>{%else%}{{''}}{%endif%}</td>
                                </tr>
                                <tr>
                                    <td>游戏名</td>
                                    <td><input style="width:50%" type="text" id="pkg-game-name" value="{{pkg.game_name}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>实际下载量</td>
                                    <td><input type="text" readonly="readonly" id="gg_download_cnt" value="{% if pkg.gg_download_cnt %}{{ pkg.gg_download_cnt }}{% endif %}" /></td>
                                </tr>
                                <tr>
                                    <td>实际周下载量</td>
                                    <td><input type="text" readonly="readonly" id="gg_download_week" value="{% if pkg.gg_download_week %}{{ pkg.gg_download_week }}{% endif %}" /></td>
                                </tr>
                                <tr>
                                    <td>渠道</td>
                                    <td><input style="width:50%" type="text" id="pkg-channel" value="{{pkg.market_channel}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>包名</td>
                                    <td><input style="width:50%" type="text" id="pkg-name" value="{{pkg.pkg_name}}" readonly="readonly" /></td>
                                </tr>
                                <tr>
                                    <td>signature_md5</td>
                                    <td><input style="width:50%" type="text" id="pkg-signature_md5" value="{{pkg.signature_md5}}" readonly="readonly" /></td>
                                </tr>
                                <tr>
                                    <td>版本号</td>
                                    <td><input style="width:50%" type="text" id="pkg-ver-code" value="{{pkg.ver_code}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>版本名</td>
                                    <td><input style="width:50%" type="text" id="pkg-ver-name" value="{{pkg.ver_name}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>大小</td>
                                    <td><input style="width:50%" type="text" id="pkg-size" value="{{pkg.file_size}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>下载量</td>
                                    <td><input style="width:50%" type="text" id="pkg-down-num" value="{{pkg.downloaded_cnts}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>语言</td>
                                    <td><input style="width:50%" type="text" id="pkg-language" value="{{game_language}}" readonly="true" /></td>
                                </tr>
                                <tr>
                                    <td>类型</td>
                                    <td><textarea id="pkg-type" rows="5" cols="140" class="required" tabindex="4" readonly="true" >{{pkg.game_types}}</textarea></td>
                                </tr>
                                <tr>
                                    <td>ICON</td>
                                    <td><img style="width:75px;height:75px;" readonly="readonly" src="{{ info.icon_url }}"></td>
                                </tr>
                                <tr>
                                    <td>截图</td>
                                    <td><textarea style="width:80%;" id="pkg-screen" rows="5" cols="140" class="required" tabindex="4" readonly="true" >{{pkg.screen_shot_urls}}</textarea></td>
                                </tr>
                                <tr>
                                    <td>描述</td>
                                    <td><textarea style="width:80%;" id="pkg-desc" rows="12" cols="140" class="required" tabindex="4" readonly="true" >{{pkg.game_desc}}</textarea></td>
                                </tr>
                                <!--tr>
                            <td><input type="button" id="pkg-btn" onclick="pkg_info_change()" value="确定修改"></td>
                        </tr-->
                                </tbody>
                            </table>
                        </div><!-- /.box -->
                    </div><!-- /.col -->
                </div><!-- /.row -->
        </section>
    </div><!-- /.content-wrapper -->
    <input type="hidden" id="game-id" value="{{ info.game_id }}"/>
    <input type="hidden" id="apk-id" value="{{pkg.apk_id}}"/>
    <textarea style="display:none" id="label-origin" readonly="readonly" rows="5" cols="140" class="required" tabindex="4">{% if info.origin_type %}{{ info.origin_type }}{% else %}{{''}}{% endif %}</textarea></td>

{% endblock %}

{% block extrajs %}
    <script type="text/javascript">
        var ckeditor_editor_desc_html = CKEDITOR.replace('ckeditor_editor_desc_html');
        var ckeditor_detail_desc_html = CKEDITOR.replace('ckeditor_detail_desc_html');

        function not_play(game_id) {
            window.location.href = '/gg_mgmt/game/not_play/?game_id='+game_id;
        }

        $("#search_plugin").click(function(){
            var search_plugin_info  = $("#search_plugin_info").attr("value");
            if(search_plugin_info){
                window.location.href = '/gg_mgmt/game/plugin_search/?search_plugin_info='+search_plugin_info;
            }else{
                alert("请输入查询内容！！！");
            }
        });

        $("#addScreen").click(function(){
            var game_id = $("#game-id").val();
            var screen_shot_url = prompt("请输入新增截图地址:");
            var descJson = {};
            descJson['game_id'] = game_id;
            descJson['screen_shot_url'] = screen_shot_url;
            $.post('/gg_mgmt/game/addScreen/', descJson, function(result){
                window.location.href = '/gg_mgmt/game/detail/?game_id='+game_id;
            });
        });

        var imgFlag = false; //鼠标放在图片上标记
        var divFlag = false; //鼠标放在删除层上标记

        function showDeleteDiv(resourceCode){
            imgFlag = true;
            $("#"+resourceCode+"DIV").css("display","block");
        };

        function hideDeleteDiv(resourceCode){
            if(!imgFlag && !divFlag){
                $("#"+resourceCode+"DIV").css("display","none");
            }
        };

        function imgOnmouseout(){
            imgFlag=false;
        };

        function divOnmouseover(resourceCode){
            divFlag = true;
            showDeleteDiv(resourceCode);
        };

        function divOnmouseout(resourceCode){
            divFlag = false;
            if(imgFlag){
                showDeleteDiv(resourceCode);
            }else{
                hideDeleteDiv(resourceCode);
            }
        };

        function previewPhoto(resourceCode) {
            //alert("查看图片"+resourceCode);
        };

        function removeGroupNotActivitySharingPhotoByResourceCode(resourceCode) {
            alert("删除图片"+resourceCode);
            $("#"+resourceCode+"IMG").parent().detach();
        }
        $(document).ready(function(){
            $("img.screen_shot_url").each(function(i){
                var divObj=$("<div onclick=removeGroupNotActivitySharingPhotoByResourceCode('"+$(this).attr('alt')+"'); onmouseover=divOnmouseover('"+$(this).attr('alt')+"'); onmouseout=divOnmouseout('"+$(this).attr('alt')+"');>×</div>");
                divObj.addClass("divX");
                divObj.attr("id",$(this).attr("alt")+"DIV");
                divObj.attr("title","删除图片"+$(this).attr('alt'));
                divObj.css({position:"absolute", left: $(this).position().left+170, top:$(this).position().top+10});
                $(this).parent().append(divObj);
            });
        });
        //

        String.format = function() {
            if( arguments.length == 0 ) {
                return null;
            }
            var str = arguments[0];
            for(var i=1;i<arguments.length;i++) {
                var re = new RegExp('\\{' + (i-1) + '\\}','gm');
                str = str.replace(re, arguments[i]);
            }
            return str;
        };

        function show_channel(g_id) {
            if(g_id) {
                clear();
                $("#game-id").val(g_id);
                $("#game-info").html('');
                // console.log(g_id);
                $.ajax({
                    type: 'post',
                    url: '/gg_mgmt/game/channel/',
                    data: {g_id: g_id, csrfmiddlewaretoken: '{{ csrf_token }}'},
                    dataType: 'json'})
                        .done(function(data){
                            if(data.status) {
                                if(data.status == '400') {
                                    alert(data.error);
                                } else if(data.status == '200') {
                                    // console.log(data.msg);
                                    if(data.msg) {
                                        var html = "";
                                        for(var i=0; i<data.msg.length; i++) {
                                            var td = '<td><a href="javascript:void(0)" onclick="show_info(\'{0}\')">{0}</a></td>';
                                            var channel = data.msg[i];
                                            alert(channel);
                                            if(i == 0) {
                                                show_info(channel);
                                            }
                                            html += String.format(td, channel);
                                        }
                                        $("#channels").html(html);
                                    }
                                }
                            }
                        })
                        .fail(function() {
                            alert("请求出错");
                        });

                // 基本信息请求
                $.ajax({
                    type: 'post',
                    url: '/gg_mgmt/game/labelinfo/',
                    data: {g_id: g_id, csrfmiddlewaretoken: '{{ csrf_token }}'},
                    dataType: 'json'})
                        .done(function(data){
                            if(data.status) {
                                if(data.status == '400') {
                                    alert(data.error);
                                } else if(data.status == '200') {
                                    // console.log(data.msg);
                                    if(data.msg) {
                                        var msg_fields = data.msg;
                                        // console.log(msg_fields);
                                        if(msg_fields) {
                                            var info = msg_fields[0].fields;
                                            if(info) {
{#                                    $("#label-search-name").val(info.search_name);#}
                                                $("#label-game-name").val(info.game_name);
                                                $("#label-download").val(info.download_counts);
                                                $("#label-language").val(info.game_language);
                                                $("#label-type").val(info.game_types);
                                                $("#label-star").val(info.star_num);
                                                $("#label-icon").val(info.icon_url);
                                                $("#label-screen").val(info.screen_shot_urls);
                                                $("#label-desc").val(info.detail_desc);
                                            }
                                        }
                                    }
                                }
                            }
                        })
                        .fail(function() {
                            alert("请求出错");
                        });
            }
        }

        function show_info(apk_id) {
            var g_id = $("#game-id").val();
            if(g_id && apk_id.length>0) {
                $.ajax({
                    type: 'post',
                    url: '/gg_mgmt/game/gameinfo/',
                    data: {g_id: g_id, apk_id: apk_id, csrfmiddlewaretoken: '{{ csrf_token }}'},
                    dataType: 'json'})
                        .done(function(data){
                            if(data.status) {
                                if(data.status == '400') {
                                    alert(data.error);
                                } else if(data.status == '200') {
                                    // console.log(data.msg);
                                    if(data.msg) {
                                        var msg_fields = data.msg;
                                        if(msg_fields) {
                                            var info = msg_fields[0].fields;
                                            $("#apk-id").val(msg_fields[0].pk);
                                            $(".pkg_id").css("color", "");
                                            $("#"+msg_fields[0].pk).css("color", "#ff0033");
                                            if(info) {
                                                $("#pkg-apk_id").val(msg_fields[0].pk);
                                                $("#pkg-game-name").val(info.game_name);
                                                $("#pkg-channel").val(info.market_channel);
                                                $("#pkg-name").val(info.pkg_name);
                                                $("#pkg-post_url").text('http://106.187.54.178/'+info.post_url);
                                                $("#pkg-post_url").attr("href", 'http://106.187.54.178/'+info.post_url);
                                                $("#pkg-signature_md5").val(info.signature_md5);
                                                $("#pkg-ver-code").val(info.ver_code);
                                                $("#pkg-ver-name").val(info.ver_name);
                                                $("#pkg-size").val(info.file_size);
                                                $("#pkg-down-num").val(info.downloaded_cnts);
                                                $("#pkg-language").val(info.game_language);
                                                $("#pkg-type").val(info.game_types);
                                                $("#pkg-down-url").text(info.download_url);
                                                $("#pkg-down-url").attr("href", info.download_url);
                                                $("#pkg-url4details").text(info.url4details);
                                                $("#pkg-url4details").attr("href", info.url4details);
                                                $("#pkg-icon").val(info.icon_url);
                                                $("#pkg-screen").val(info.screen_shot_urls);
                                                $("#pkg-desc").val(info.game_desc);
                                                if(info.required_plugin_ids) {
                                                    var html = "<td>插件ID</td><td>";
                                                    var array = info.required_plugin_ids.split('\n');
                                                    for(var i=0; i<array.length; i++) {
                                                        //        var td = '<a href="javascript:void(0)" onclick="show_info(\'{0}\')">{0}</a>&nbsp;';
                                                        var td = '<a href="/gg_mgmt/game/plugin_detail/?plugin_id={0}">{0}</a>&nbsp;';
                                                        var channel = array[i];
                                                        html += String.format(td, channel);
                                                    }
                                                    html += "</td>"
                                                    $("#pkg-required_plugin_ids").html(html);
                                                }else{
                                                    var html = "";
                                                    $("#pkg-required_plugin_ids").html(html);
                                                }
         
                                            }
                                        }

                                    }
                                }
                            }
                        })
                        .fail(function() {
                            alert("请求出错");
                        });
            }
        }


        function label_info_change() {
            var game_id = $("#game-id").val();
            if(game_id) {
                var subscript = "";
                $('input[type="radio"][name="subscript"]:checked').each(function(){
                    subscript = $(this).val();
                    //alert($(this).val());
                });
                var save_detail_desc_html = "";
                $('input[type="radio"][name="save_detail_desc_html"]:checked').each(function(){
                    save_detail_desc_html = $(this).val();
                    //alert($(this).val());
                });
                var status = "";
                $('input[type="radio"][name="status"]:checked').each(function(){
                    status = $(this).val();
                    //alert($(this).val());
                });
                var show_hot_icon = "";
                $('input[type="radio"][name="show_hot_icon"]:checked').each(function(){
                    show_hot_icon = $(this).val();
                });
                var filter_pkg_names = "";
                $("#filter_pkg_names option").each(function (){
                    filter_pkg_names = filter_pkg_names + $(this).text() + "\n";
                });
                var color_label = "";
                $('input[type="checkbox"][name="color_label"]:checked').each(function(){
                    color_label = color_label + $(this).val() + "\n";
                });
                //color_label_sel
                $('select[name="color_label_sel"]').each(function(){
                    if($(this).val() != "-1") {
                        color_label = color_label + $(this).val() + "\n";
                    }
                });
                if (color_label.length > 0){
                    color_label = color_label.substr(0, color_label.length - 1);
                }
                var label_category = "";
                $('input[type="checkbox"][name="label_category"]:checked').each(function(){
                    label_category = label_category + $(this).val() + "\n";
                });
                if (label_category.length > 0){
                    label_category = label_category.substr(0, label_category.length - 1);
                }
                var label_origin = $("#label-origin").val();
                //alert(label_type);
                //alert(color_label);
                //alert(label_category);
                var screen = "";
                $('img.screen_shot_url').each(function(){
                    screen = screen + $(this).attr("src") + "\n";
                    //color_label = color_label + $(this).val() + "\n";
                });
                if (screen.length > 0){
                    screen = screen.substr(0, screen.length - 1);
                }
                var display_name = $("#label-display-name").val();
                var game_alias = $("#label-game_alias").val();
                var download_num = $("#label-download").val();
                var language = $("#label-language").val();
                var star = $("#label-star").val();
                var icon = $("#label-icon").val();
                var banner_pic = $("#banner_pic").val();
                //     var screen = $("#label-screen").val();
                var short_desc = $("#label-short-desc").val();
                var desc = $("#label-desc").val();
                var disable_reason = $("#disable_reason").val();
                var dev_name = $("#dev_name_select").val();
                var subscript_expire_time = $("#subscript_expire_time").val();
                var detail_url = $("#detail_url").val();
                var editor_desc_html = ckeditor_editor_desc_html.document.getBody().getHtml();
                var detail_desc_html = ckeditor_detail_desc_html.document.getBody().getHtml();
                if(dev_name == '请选择...') {
                    dev_name = '';
                }
                $.ajax({
                    type: 'post',
                    url: '/gg_mgmt/game/label_info_change/',
                    data: {game_id: game_id,
                        display_name: display_name,
                        subscript: subscript,
                        status: status,
                        disable_reason: disable_reason,
                        color_label: color_label,
                        download_num: download_num,
                        language: language,
                        //     type: type,
                        star: star,
                        icon: icon,
                        screen: screen,
                        short_desc: short_desc,
                        desc: desc,
                        detail_desc_html: detail_desc_html,
                        editor_desc_html: editor_desc_html,
                        types: label_origin,
                        categorys: label_category,
                        game_alias: game_alias,
                        detail_url: detail_url,
                        dev_name: dev_name,
                        save_detail_desc_html: save_detail_desc_html,
                        subscript_expire_time: subscript_expire_time,
                        banner_pic: banner_pic,
                        filter_pkg_names: filter_pkg_names,
                        show_hot_icon: show_hot_icon,
                        csrfmiddlewaretoken: '{{ csrf_token }}'},
                    dataType: 'json'})
                        .done(function(data){
                            if(data.status) {
                                if(data.status == '400') {
                                    alert(data.error);
                                } else if(data.status == '200') {
                                    // console.log(data.msg);
                                    alert("修改成功");
                                }
                            }
                        })
                        .fail(function() {
                            alert("请求出错");
                        });
            }
        }

        function pkg_info_change() {
            var apk_id = $("#apk-id").val();
            if(apk_id) {
                var enabled = "";
                $('input[type="radio"][name="pkg-enabled"]:checked').each(function(){
                    enabled = $(this).val();
                });
                var disable_reason = $("#pkg-disable_reason").val();
                var dl_button_txt = $("#pkg-dl_button_txt").val();
                var dl_button_color = $("#pkg-dl_button_color").val();
                var gles_version = $("#pkg-gles_version").val();
                $.ajax({
                    type: 'post',
                    url: '/gg_mgmt/game/pkg_info_change/',
                    data: {apk_id: apk_id,
                        enabled: enabled,
                        disable_reason: disable_reason,
                        dl_button_txt: dl_button_txt,
                        dl_button_color: dl_button_color,
                        gles_version: gles_version,
                        csrfmiddlewaretoken: '{{ csrf_token }}'},
                    dataType: 'json'})
                        .done(function(data){
                            if(data.status) {
                                if(data.status == '400') {
                                    alert(data.error);
                                } else if(data.status == '200') {
                                    // console.log(data.msg);
                                    alert("修改成功");
                                }
                            }
                        })
                        .fail(function() {
                            alert("请求出错");
                        });
            }
        }

        function clear() {
            $("#apk-id").val("");
            $("#pkg-game-name").val("");
            $("#pkg-channel").val("");
            $("#pkg-name").val("");
            $("#pkg-ver-code").val("");
            $("#pkg-ver-name").val("");
            $("#pkg-size").val("");
            $("#pkg-down-num").val("");
            $("#pkg-language").val("");
            $("#pkg-type").val("");
            $("#pkg-down-url").val("");
            $("#pkg-icon").val("");
            $("#pkg-screen").val("");
            $("#pkg-desc").val("");

            $("#label-search-name").val("");
            $("#label-game-name").val("");
            $("#label-download").val("");
            $("#label-language").val("");
            $("#label-type").val("");
            $("#label-star").val("");
            $("#label-icon").val("");
            $("#label-screen").val("");
            $("#label-desc").val("");
        }
        $("#add_filter_pkg_names").click(function(){
            var value = prompt('请输入pkg_name的正则表达式:');
            if (value) {
                var filter_pkg_names = [];
                $("#filter_pkg_names option").each(function (){
                    filter_pkg_names.push($(this).text());
                });
                if ($.inArray(value, filter_pkg_names) == -1) {
                    $("#filter_pkg_names").append("<option id='option_"+value+"' onclick="+"del_filter_pkg_names('"+value+"')"+" value='"+value+"'>"+value+"</option>");
                } else {
                    alert('正则表达式已存在，请重新输入！！！');
                }
            }
        });
        function del_filter_pkg_names(id) {
            if(confirm('确认删除吗？')){
                $("#option_"+id).remove();
            }
        }
    </script>
    <script type="text/javascript" src="/gg_mgmt/static/js/adddate.js"></script>
{% endblock %}
